

<!--
todo: 
- clean code
- https://github.com/expressjs/multer for upload of files
- implement field mapping
 - read header of csv
 - provide mongoDB model
 - provide drop down fields for matching

-->

<script type="text/javascript"> 
//
var aAsc = [];
function sortTable(e) { 

	var nr = $(e.currentTarget).index(); 
	aAsc[nr] = aAsc[nr]=='asc'?'desc':'asc';
	$('.xtable > tbody > tr').tsort('tr["num"], td:eq('+nr+')',{order:aAsc[nr]});
}

jQuery(document).ready(function(e) { 
	$('.xtable').find('thead th').siblings().bind('click', function(e){ 
		sortTable(e); 
	});
});	

//
var show_bio = function(cl){ 
	$('.xtable').find('tr.bio').each(function(i, val){
		$(this).hide(); 
	});
	$('tr.'+cl).show();
}

//alert(markdown.toHTML('# hrllo'));
//$('#mark').html(markdown.toHTML($('#mark').text()));
</script>


<div class="col-md-10">
<h2>Users</h2>
<a class="btn btn-default btn-xs" href="#" data-toggle="collapse" data-target="#addUserPanel" aria-expanded="false" aria-controls="collapseExample">add new user</a>
<a class="btn btn-default btn-xs" href="#" data-toggle="collapse" data-target="#importCsvPanel" aria-expanded="false" aria-controls="collapseExample2">import csv</a>

<div id="importCsvPanel" class="edit-form collapse admin-edit-form">
	<div class="panel-heading">Import users from CSV</div>
	<form action="/users/import-csv" method="post" accept-charset="utf-8">  
		<div class="btn btn-xs btn-default btn-file">
		  Browse File <input type="file">
		</div>
		<div class="input-group input-group-xs">
				<textarea name="user-csv"></textarea>
		</div>
		<div class="checkbox">
			<label><input type="checkbox" name="replace-existing-users" value="">Replace existing users</label>
		</div>
		<br>
		<div class="buttons">
			<button type="submit" class="btn-default btn">import</button> 
			<a href="javascript:render('admin-users', '/json/users', true, '.admin-panel');">cancel</a>
		</div>	
	</form>	
</div>

<div id="addUserPanel" class="edit-form collapse admin-edit-form">
		<div class="panel-heading">Add a new user</div>   
   <form action="/users/create" method="post" accept-charset="utf-8">
    	<div class="input-group input-group-xs">
				<span class="input-group-addon" id="sizing-addon1">Username</span>
				<input type="text" class="form-control" placeholder="username" aria-describedby="sizing-addon1" name="username" value="">
      </div>
      <br>
      <div class="input-group input-group-xs">
				<span class="input-group-addon" id="sizing-addon1">Name</span>
				<input type="text" class="form-control" placeholder="name" aria-describedby="sizing-addon1" name="name" value="">
      </div>
      <br>
       <div class="input-group input-group-xs">
				<span class="input-group-addon" id="sizing-addon1">First name</span>
				<input type="text" class="form-control" placeholder="firstname" aria-describedby="sizing-addon1" name="firstname" value=">">
      </div>
      <br>
       <div class="input-group input-group-xs">
				<span class="input-group-addon" id="sizing-addon1">Name</span>
				<input type="text" class="form-control" placeholder="name" aria-describedby="sizing-addon1" name="name" value="">
      </div>
      <br>
      
      <div class="input-group input-group-xs">
				<span class="input-group-addon" id="sizing-addon1">Role</span>
				<input type="text" class="form-control" placeholder="role" aria-describedby="sizing-addon1" name="title" value="">
      </div>
      <br>
      
       <div class="input-group input-group-xs">
				<span class="input-group-addon" id="sizing-addon1">Email</span>
				<input type="text" class="form-control" placeholder="email" aria-describedby="sizing-addon1" name="email" value="">
      </div>
      <br>
      
      <div class="input-group input-group-xs">
				<span class="input-group-addon" id="sizing-addon1">Password</span>
				<input type="password" class="form-control" placeholder="password" aria-describedby="sizing-addon1" name="password" value="">
      </div>
      <br>
			
			
			<div class="buttons">
				<button type="submit" class="btn-default btn">save</button>  <a href="javascript:render('admin-users', '/json/users', true, '.admin-panel');">cancel</a>
			</div>
    </form>
	</div>



<table class="xtable">
<thead>
	<th></th>
	<th>user name</th>
	<th>surename</th>
	<th>given name</th>
	<th>role</th>
	<th>groups</th>
</thead>
<tbody>
	<% onliner = 0 %>
	<% if (items.length) { %>
	<% i=0 %>	
		<% items.forEach(function(item){ i++ %>
			<tr class="meta" num="e<%= i %>">
				<td><img width="15" src="/static/img/user-icons/user-<%= item.id %>.png" /></td> 
				<td><a href="javascript:render('admin-users-edit','/admin/users/edit/<%=: item.username %>', true, '.admin-panel');" title=""><%= item.username %></a></td>
				<td><%=: item.name %></td>
				<td><%= item.firstname %></td>
				<td><%=: item.role %></td>
				<td><%= item.groups %></td>
		</tr>
		<% if( item.status.online ){ onliner++ }%>
     <% }) %>
 	<% } %>
      
  </tbody>
</table>
ONLINE: <%= onliner %>
</div> 
    
